---
navTitle: Commit Scopes
title: Commit Scopes
indexdepth: 4
refprefix: cs
rootisheading: true
deepToC: true
---

Commit Scopes are rules which determine how transaction commits and conflicts are handled within a PGD system.

## Commit Scope syntax

The overall grammar for commit scope rules is composed as follows:

```
commit_scope:
    commit_scope_operation [AND ...]

commit_scope_operation:
    commit_scope_group commit_scope_visibility commit_scope_kind

commit_scope_visibility:
    [ ON { received|replicated|durable|visible } ]

commit_scope_group:
{ ANY num (node_group [, ...])
  | MAJORITY (node_group [, ...])
  | ALL (node_group [, ...]) }

commit_scope_kind:
{ GROUP COMMIT [ ( group_commit_parameter = value [, ...] ) ] [ ABORT ON ( abort_on_parameter = value ) ]
  | CAMO [ DEGRADE ON ( degrade_on_parameter = value ) TO ASYNC ]
  | LAG CONTROL [ ( lag_control_parameter = value [, ... ] ) ] 
  | SYNCHRONOUS_COMMIT }
```

* `node_group` &mdash; Name of a node group.

More details of the commit scope kinds and details of their parameters:

* [Group Commit](#group-commit)  
* [CAMO (Commit At Most Once)](#camo)  
* [Lag Control](#lag-control) 
* [Synchronous Commit](#synchronous-commit)


## Commit Scope kinds

!!! Note Parameter values 
Boolean, enum, int and interval values are specified using the [Postgres GUC Parameter value conventions](https://www.postgresql.org/docs/current/config-setting.html#CONFIG-SETTING-NAMES-VALUES). 
!!!

### GROUP COMMIT

Allows commits to be confirmed by a consensus of nodes and controls conflict resolution settings.

```
GROUP COMMIT [ ( group_commit_parameter = value [, ...] ) ] [ ABORT ON ( abort_on_parameter = value ) ]
```

#### GROUP COMMIT parameters
 Parameter | Type | Default | Description
 --- | --- | --- | ---
 `transaction_tracking` | Boolean | Off/False | Specifies whether to track status of transaction. See [transaction_tracking settings](#transaction_tracking_settings)
 `conflict_resolution` | enum | async | Specifies how to handle conflicts. (`async`|`eager`).  See [conflict_resolution settings](#conflict_resolution_settings)
 `commit_decision` | enum | group | Specifies how the COMMIT decision is made. (`group`|`partner`|`raft`). See [commit_decision settings](#commit_decision_settings)


#### ABORT ON parameters

 Parameter | Type | Default | Description 
 --- | --- | --- | ---
 `timeout` | interval | 0 | Timeout in milliseconds (accepts other units).  (0 means not set)

#### transaction_tracking settings

When set to true, two phase commit transactions will:
* Lookup commit decisions when a writer is processing a PREPARE message.
* When recovering from an interruption, lookup the transactions prepared before the interruption. When found it will then lookup the commit scope of the transaction and any corresponding RAFT commit decision. If the node is the origin of the transaction and doesn't have a RAFT commit decision, and transaction_tracking in on in the commit scope, it will periodically look for a RAFT commit decision for this unresolved transaction until it is committed or aborted.

#### conflict_resolution settings

The value `async` means resolve conflicts asynchronously during replication using the conflict resolution policy.

The value `eager` means that conflicts are resolved eagerly during COMMIT by aborting one of the conflicting transactions.

See [Group Commit/Conflict Resolution](group-commit#conflict_resolution)

#### commit_decision settings
 
The value `group` means the preceding `commit_scope_group` specification also affects the COMMIT decision, not just durability. 

The value `partner`  means the partner node decides whether transactions can be committed. This value is allowed only on groups with 2 data nodes. 

The value `raft` means the COMMIT decision is done using Raft consensus independent of `commit_scope_group` consensus.

See [Group Commit/Commit Decision](group-commit#commit_decision)


### CAMO

Enables protection, with the client's cooperation, to prevent multiple insertions of the same transaction in failover scenarios.

See [CAMO](../durability/camo) in the Durability guide for more details.

```
  CAMO [ DEGRADE ON ( degrade_on_parameter = value ) TO ASYNC ]
```

#### Degrade On parameters

Allows degrading to asynchronous operation on timeout.

 Parameter | Type | Default | Description
 --- | --- | --- | ----
 timeout | interval | 0 | Timeout in milliseconds (accepts other units) after which operation becomes asynchronous. (0 means not set)
 require_write_lead | Boolean | False | Specifies whether the node must be a write lead to be able to switch to asynchronous mode. (Only used with CAMO)

### LAG CONTROL


Allows the configuration of dynamic rate-limiting controlled by replication lag.

See [Lag Control](../durability/lag-control) in the Durability guide for more details.

```
  LAG CONTROL [ ( lag_control_parameter = value [, ... ] ) ] 
```

 Parameter | Type | Default | Description
 --- | --- | --- | --- 
 `max_lag_size` | int | 0 | Maximum allowed lag based on WAL bytes.  (0 means not set)
 `max_lag_time` | interval | 0 | Maximum allowed lag based on wall clock sampling.  (0 means not set)
 `max_commit_delay` | interval | 0 | Maximum delay that can be injected to commit to try to keep within the lag limits.  (0 means not set)

### SYNCHRONOUS_COMMIT

TODO:
