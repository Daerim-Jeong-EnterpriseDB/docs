---
title: Using EDB SQL Assess
navTitle: Using
---

The application SQL assessment tool (AssessSQL) provided by the EDB SQL Assess capability is a Java-based command line tool that the end user can download and install in their local environment. Once installed, it can assess SQL statements provided as an input file. The input file can either be an Oracle trace file, an extracted SQL file, or a plain SQL file. In order to create an Oracle trace file, the end user can run a test program or regression test suite that performs most of the possible user actions so that all queries get captured in the trace file. To generate an extracted SQL file, the user can run the `edb_query_extractor` SQL script.

The tool doesn't provide the ability to help put Oracle in trace mode or automatically retrieve the trace file.  The generation and retrieval of the trace file from the server (if different than the machine where the tool is being run) are separate operations performed manually by the user.

## Generating a SQL trace file

The EDB SQL Assess utility provides the ability to parse Oracle trace files to identify the SQL statements that were executed during an application database session. Once identified, it can assess those statements for their compatibility with EDB Postgres Advanced Server.

To generate the trace file for an application, perform the following steps:

1. Start the application and let the application connect to the Oracle database server. 

   For the remaining steps, assume that the Oracle user used by the application in the examples is RS4_LIN32.

2. Connect to the Oracle database using SQL*Plus, SQL Developer, or another Oracle client as a user with privileges. With the privileged user, query the `SYS.V$SESSION` and `SYS.V$PROCESS` synonyms and underlying `SYS.V_$SESSION` and `V_$PROCESS` tables and execute the `DBMS_SYSTEM.SET_SQL_TRACE_IN_SESSION` procedure to initiate a trace.

3. In the Oracle client (for example, SQL*Plus), execute the following query to retrieve the session Id (SID) and serial number for the application connection:

   ```SQL
   SELECT sid, serial#, substr(username, 1, 10), process FROM sys.v_$session WHERE username = 'RS4_LIN32';
   __OUTPUT__

    SID   SERIAL#   SUBSTR(USERNAME,1,10)    PROCESS
   ---- ---------- ------------------------ --------
	16	   6590     RS4_LIN32                35835
   ```
   !!! Tip
      Note the `SID` and `SERIAL#` returned by the query.

4. In the Oracle client, execute the following statement to start a trace:
   
   ```SQL
   EXECUTE dbms_system.set_sql_trace_in_session(16, 6590, true);
   ```

     This statement enables SQL tracing for the session initiated by the application.

   !!! Note
     Depending on the applicationsâ€™ database activity, the trace files may become large and could impact database resource usage and performance.  In operational environments especially, it is recommended that a trace be run for only the amount of time required to collect the necessary application queries.  For more information about the Oracle SQL Trace Facility and related guidelines on performing application tracing, visit the [Oracle documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/tgsql/performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9).  
   !!!

      Instructions for stopping the trace are provided in the last step of this procedure.


5. Run use cases of the application or run the regression test suite for the application so that the application generates most of the SQL statements.  

6. In the Oracle client, execute the following query to retrieve the `SPID`, which can be used to identify the trace file generated for the application session:

   ```SQL
   SELECT a.sid, a.serial#, substr(a.username, 1, 10) usr, substr(a.osuser,1,5) osusr, b.spid FROM v$session a, v$process b WHERE a.paddr= b.addr and a.sid=16;
   __OUTPUT__
    SID  SERIAL#    USR               OSUSR       SPID
   ---- ---------- ---------------- ------------ --------
    16   6590       RS4_LIN32        abbas        122523
   ```

   !!! Tip
     Note the `SPID` returned by the query.


7. In the Oracle client, execute the following query to find the location of the trace file:

   ```SQL
   SELECT physical_path||'/'||physical_file trace_file FROM x$dbgdirext where physical_file like '%\_122523.trc' ESCAPE '\';
   __OUTPUT__
   TRACE_FILE
   ------------------------------------------------------------------------
   /u01/app/Oracle/diag/diag/rdbms/orcl/ORCL/trace/ORCL_ora_122523.trc
   ```

     When running the above query in your environment, replace `122523` with the `SPID` value returned by the query executed in the previous step.

  !!! Note
     Oracle introduced the `V$DIAG_TRACE_FILE` view in Oracle 12c Release 2 that can be queried instead of the `X$DBGDIREXT` table. The following query could be used to retrieve the trace file information from the view:
     
     ```SQL
     SELECT adr_home||'/'||trace_filename FROM V$DIAG_TRACE_FILE WHERE trace_filename LIKE '%\_43445.trc' ESCAPE '\';
     ```

     In both queries, a forward slash `/` is concatenated onto the trace directory path, which would be correct for Linux based systems. For Windows, however, the forward slash should be replaced with a backward slash `\`.

8. Find the trace file returned by the query in the previous step on the database server host machine: 

     In this example, the following is the full path to the file to locate:

   ```text
   /u01/app/Oracle/diag/diag/rdbms/orcl/ORCL/trace/ORCL_ora_122523.trc
   ```

9. Copy the trace file and share it with the migration assessment team.

10. In the Oracle client, execute the following statement to stop tracing of the application session:

   ```SQL
   EXECUTE dbms_system.set_sql_trace_in_session(16, 6590, false);
   ```

## Using the EDB Query Extractor

The EDB Query Extractor is a SQL script that can be executed via SQL*Plus to extract queries run by the user application from the `V$SQL` system table. The EDB Query Extractor script expects four input parameters:

- Location for output file &mdash; Provide the path where you want the EDB Query Extractor to place the SQL statements extracted from the `V$SQL` table. By default, the trace file generates from the location where SQLPlus was run from.

- The name of the user whose queries are to be extracted &mdash; The script extracts the SQL statements run only by the provided Oracle user. By default, the script uses the current logged-in user.

- The start timestamp of the queries &mdash; Provide the starting timestamp of the queries to extract in the format DD-MM-YYYY HH24:MI:SS. By default, the script uses `01-01-1970`.

- The end timestamp of the queries &mdash; Provide the ending timestamp of the queries to extract in the format DD-MM-YYYY HH24:MI:SS. By default, the script uses the current time.

The following is an example of the EDB Query Extractor input parameters:

```
SQL>@edb_queries_extractor.sql
# -- EDB Query Extractor Version 1.0.0 for Oracle Database -- #
# ----------------------------------------------------------- #
Caution:
Script USER must have CONNECT role and SELECT ANY DICTIONARY privilege.
(To verify granted roles and privileges, run the following commands: SELECT granted_role FROM user_role_privs;  or  SELECT privilege FROM user_sys_privs;)
Press RETURN to continue ...
Location for output file (Default current location): /tmp/
Enter the name of the user whose queries are to be extracted (Default current user): rs2_lin32
Enter the start timestamp of the queries (DD-MM-YYYY HH24:MI:SS) (Default 01-01-1970): 
Enter the end timestamp of the queries (DD-MM-YYYY HH24:MI:SS) (Default current time): 

Writing queries to /tmp/RS2_LIN32_230518054450.out
####################################################################################################
## EDB Query Extractor Utility. Version: 1.0.0
##
## Source Database Version	: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
## Queries Extracted for User	: rs2_lin32 (User Id: 109)
## Time Duration for Extraction	: 01-01-1970 00:00:00 to 18-05-2023 05:44:50
## Extracted On			: 18-05-2023 05:44:50
####################################################################################################
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

```

## Using plain SQL files

The following are some plain SQL statements that are valid when using the EDB Query Extractor: 

```sql
INSERT INTO PLSQLTEST VALUES ('Hello World');

INSERT INTO PLSQLTEST VALUES (:B1 );

SELECT * FROM EMP WHERE JOB = :B1;

DELETE FROM PLSQLTEST;

BEGIN
PRO_DROP_PRIMARY_KEY('PK_NAME_HERE');

MSCH.INS_LOG_MSG(:msg_number, :msg_proc_id, 'DROP PRIMARY KEY' , :msg_type);
END;
```

## Performing a SQL assessment

After generating the trace files using either the Oracle trace utility or the EDB Query Extractor, the user can run the `assessSQL.jar` file using the `runSQLAssess.sh` script to generate a report. The report helps the user to identify the compatibility of the application for porting the application to EDB Postgres Advanced Server. The tool also generates SQL output files. The queries in these output files can then be modified to be compatible with EDB Postgres Advanced Server syntax. 

### Command options

```shell
/usr/edb/sqlassess/bin/runSQLAssess.sh -help
usage: assessSQL <options>
 -appname <name>             Specify the name of the application
 -help                       Print all available options
 -includeUIDs <userIDs>      Specify comma separated list of User IDs for
                             assessment consideration
 -inputfilepath <path>       Specify the path containing the input file/s
 -inputfiletype <filetype>   Specify either trace, exported or plain
 -loglevel <level>           Specify logging level e.g. off, info, fine
 -reportpath <path>          Specify the path where report will be saved
 -sourcedb <version>         Specify source database e.g. oracle_19c
 -targetdb <version>         Specify target database e.g. epas_15
 -version                    Print the version information and exit


/usr/edb/sqlassess/bin/runSQLAssess.sh -version
EDB SQL Assess ver 1.0.0-preview

/usr/edb/sqlassess/bin/runSQLAssess.sh -appname TeleApp -inputfilepath /some/valid/path/ -inputfiletype plain -reportpath /some/valid/path/ -sourcedb Oracle_19c -targetdb epas_15 -loglevel FINE

EDB SQL Assess ver 1.0.0-preview
Input file type: PLAIN
Input file path: /home/edb/Projects/
Report path: /home/edb/Projects/
Application Name: TeleApp
Source Database: ORACLE_19C
Target Database: EPAS_15
Logging Level: FINE
Processing File: t0.sql...
Generating Report....
Connected to H2 ..
**********************
Generating report ....
**********************
Report generation complete.
Another example providing only the mandatory command line options.

./runSQLAssess.sh -inputfilepath /home/edb/ -inputfiletype trace -reportpath /home/edb/
EDB SQL Assess ver 1.0.0-preview
Input file type: TRACE
Input file path: /home/edb/
Report path: /home/edb/
Application Name: TestApp
Source Database: ORACLE_19C
Target Database: EPAS_15
Logging Level: INFO
Processing File: orcl_ora_117637.trc...
Generating Report....
Connected to H2 ..
**********************
Generating report ....
**********************
Report generation complete.
```

!!! note
   The suggested query syntax for procedure calls in the generated SQL output files is compatible with executing those calls via JDBC and other languages. For example, a procedure call like:
   
   ```
   begin procin (:1 ); end;      
   ```

   Is converted to the following call:

   ```
   {CALL procin (? ) }
   ```
       
!!!

### `includeUIDs` parameter

The `includeUIDs` parameter can filter queries from trace files with a comma separated list of Oracle UID values, like `106, 1120`. The `includeUIDs` parameter doesn't filter queries from exported or plain SQL files. 

For example, if a user provides the value `106`, then the queries associated only with UID 106 are assessed and all other queries are discarded. If a user doesn't provide a value for this parameter, by default the assessSQL utility discards queries for `UID=0` and assesses all other queries.

To obtain the UID of an Oracle user, run the following query after connecting to the Oracle database as the user: 

```sql
SELECT UID FROM DUAL;
```

#### Example

```
./runSQLAssess.sh -includeUIDs 109,93 -inputfilepath /home/edb/ -inputfiletype trace -reportpath /home/edb/
EDB SQL Assess ver 1.0.0-preview
Input file type: TRACE
Input file path: /home/edb/
Report path: /home/edb/
Application Name: TestApp
Source Database: ORACLE_19C
Target Database: EPAS_15
Logging Level: INFO
Processing File: ORCL_ora_35652.trc...
Generating Report....
Connected to H2 ..

Generating report ....

Report generation complete.
```

## Reviewing EDB SQL Assess reports

EDB SQL Assess divides the features used by application queries into four categories:

- **Compatible features** &mdash; Provides the count of compatible features used in queries.

- **Features with existing available workaround** &mdash; Provides the count of features with known and practical workarounds used in queries.

- **Features with reasonable effort new workaround** &mdash; Provides the count of features where no practical in-database workaround is available and that may require a change in the application architecture.

- **Features with no workaround or requiring further investigation** &mdash; Provides the count of incompatible features for which further investigation is required.

The generated report contains the following tables:

- Overall feature compatibility summary

- Compatibility summary for each input file

- Incompatible features for each input file &mdash; Contains a list of incompatible features used by queries in the input file. Also provides the query ID of the query that uses this incompatible feature.

- Incompatible queries for each input file &mdash; Contains a list of all incompatible queries along with the incompatible features used in that query.

- Queries with suggested repairs &mdash; Provides two rows per query. The first row contains the original query and the second row contains the modified query. The incompatible feature that is repaired in the modified query is also provided.
