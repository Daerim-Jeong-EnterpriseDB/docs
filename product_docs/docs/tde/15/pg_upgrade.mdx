---
title: "pg_upgrade"
---

TDE-specific options to [pg_upgrade](https://www.postgresql.org/docs/15/pgupgrade.html):

## Options

`--copy-by-block`
    Copy files to the new cluster block by block (instead of the default, which is to copy the whole file at once). This option is the same as the default mode but somewhat slower. It does, however, support upgrades between clusters with different encryption settings.

    This option must be used when upgrading between clusters with different encryption settings (unencrypted to encrypted, encrypted to unencrypted, or both encrypted with different keys). While copying files to the new cluster, it will decrypt them and re-encrypt them with the keys and settings of the new cluster.

    For the avoidance of doubt: If the old cluster is encrypted and the new cluster was initialized as unencrypted, this option will decrypt the data from the old cluster and copy it to the new cluster unencrypted. If the old cluster is unencrypted and the new cluster was initialized as encrypted, this option will encrypt the data from the old cluster and place it into the new cluster encrypted.

`--key-unwrap-command=command`

    Specifies a command to unwrap (decrypt) the data encryption key. The command should include a placeholder %p that specifies the file to read the wrapped key from. The command needs to write the unwrapped key to its standard output. If this is not specified, the environment variable PGDATAKEYUNWRAPCMD is used. An empty string means to not apply any key unwrapping command. Specifying this option or the environment variable fallback is required if data encryption is used. See Section 19.13.2 for further information.