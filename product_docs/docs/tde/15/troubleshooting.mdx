---
title: "Troubleshooting with encrypted WAL files"
navTitle: WAL files
---

WAL files can be encrypted. There are options to the WAL commands to use when troubleshooting with encrypted WAL files. 

## Dumping a TDE-encrypted WAL file

To work with an encrypted WAL file, the [pg_waldump](https://www.postgresql.org/docs/15/pgwaldump.html) needs to be aware of the unwrap key. You can either pass the key for the unwrap command using the following option to the `pg_waldump` command or depend on the fallback environment variable.

|             Option             |                                                                                                                                                                                                                                                                                                                                           Description                                                                                                                                                                                                                                                                                                                                           |
| ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| --data-encryption              | Consider the WAL files to be encrypted and decrypt them before processing them. This must be specified if the WAL files have been encrypted by transparent data encryption. `pg_waldump` cannot automatically detect whether WAL files are encrypted.                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| --key-file-name=*file*         | Load the data encryption key from the given location.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| --key-unwrap-command=*command* | Specifies a command to unwrap (decrypt) the data encryption key. The command should include a placeholder `%p` that specifies the file to read the wrapped key from. The command needs to write the unwrapped key to its standard output. If this is not specified, the environment variable `PGDATAKEYUNWRAPCMD` is used. The `PGDATAKEYUNWRAPCMD` environment variable specifies the default for the option --key-unwrap-command. <br /> <br /> An empty string means to not apply any key unwrapping command. Specifying this option or the environment variable fallback is required if data encryption is used. See [Securing the data encryption key](docs/tde/latest/key_stores/) for further information. |



### Resetting a corrupt, TDE-encrypted WAL file

To reset a corrupt, encrypted WAL file, the [pg_resetwal](https://www.postgresql.org/docs/15/app-pgresetwal.html) command needs to be aware of the unwrap key. You can either pass the key for the unwrap command using the following option to the `pg_resetwal` command or depend on the fallback environment variable.

| Option | Description | 
| ------- | ---------- |
| --key-unwrap-command=*command* | Specifies a command to unwrap (decrypt) the data encryption key. The command should include a placeholder `%p` that specifies the file to read the wrapped key from. The command needs to write the unwrapped key to its standard output. If this is not specified, the environment variable `PGDATAKEYUNWRAPCMD` is used. The environment variable `PGDATAKEYUNWRAPCMD` specifies the default for the option `--key-unwrap-command`. <br /> <br /> An empty string means to not apply any key unwrapping command. Specifying this option or the environment variable fallback is required if data encryption is used. See [Securing the data encryption key](docs/tde/latest/key_stores/) for further information. |

