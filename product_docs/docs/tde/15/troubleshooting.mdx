---
title: "Troubleshooting with encrypted WAL files"
---

WAL files can be encrypted. There are options to the WAL commands to use when troubleshooting with encrypted WAL files.

## Dumping a TDE-encrypted WAL file

To work with an encrypted WAL file, use these options to the [pg_waldump](https://www.postgresql.org/docs/15/pgwaldump.html) command:

| Option | Description | 
| ------- | ---------- |
| --data-encryption | Consider the WAL files to be encrypted and decrypt them before processing them. This must be specified if the WAL files have been encrypted by transparent data encryption. pg_waldump cannot automatically detect whether WAL files are encrypted. |
| --key-file-name=*file* | Load the data encryption key from the given location.
| --key-unwrap-command=*command* | Specifies a command to unwrap (decrypt) the data encryption key. The command should include a placeholder `%p` that specifies the file to read the wrapped key from. The command needs to write the unwrapped key to its standard output. If this is not specified, the environment variable `PGDATAKEYUNWRAPCMD` is used. An empty string means to not apply any key unwrapping command. Specifying this option or the environment variable fallback is required if data encryption is used. See [Key management](/tde/latest/#key-management) for further information. <br /> The `PGDATAKEYUNWRAPCMD` environment variable specifies the default for the option --key-unwrap-command. |



### Resetting a corrupt, TDE-encrypted WAL file

To reset a corrupt, encrypted WAL file, use these options to the [pg_resetwal](https://www.postgresql.org/docs/15/app-pgresetwal.html) command:

| Option | Description | 
| ------- | ---------- |
| --key-unwrap-command=*command* | Specifies a command to unwrap (decrypt) the data encryption key. The command should include a placeholder `%p` that specifies the file to read the wrapped key from. The command needs to write the unwrapped key to its standard output. If this is not specified, the environment variable `PGDATAKEYUNWRAPCMD` is used. An empty string means to not apply any key unwrapping command. Specifying this option or the environment variable fallback is required if data encryption is used. See [Key management](/tde/latest/#key-management) for further information. <br /> The environment variable `PGDATAKEYUNWRAPCMD` specifies the default for the option `--key-unwrap-command`. |




----------
DR: WE NEED A STRATEGY FOR THIS CONTENT
TDE-specific file locations:

## File locations

| Option | Description | 
| ------- | ---------- |
| data_encryption_key_unwrap_command (*string*) | <p> Specifies a command to unwrap (decrypt) the data encryption key. The command should contain a placeholder `%p`, which will be replaced by the name of the file containing the key to unwrap. The command must print the unwrapped (decrypted) key to its standard output. If this is not specified, the environment variable `PGDATAKEYUNWRAPCMD` is used. An empty string means to not apply any key unwrapping command. Specifying this option or the environment variable fallback is required if data encryption is used. See [Key management](/tde/latest/#key-management) for more information. This parameter can only be set at server start. </p> This parameter is normally initialized by `initdb` and doesn't need to be changed unless the key wrap method is changed.


## See also
[PostgreSQL File Locations documentation](https://www.postgresql.org/docs/15/runtime-config-file-locations.html)